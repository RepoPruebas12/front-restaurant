<div class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 p-4 md:p-6">
  <!-- Header -->
  <div class="mb-6">
    <h1 class="text-2xl md:text-3xl font-bold text-gray-900 mb-1">Mesas del Restaurante</h1>
    <p class="text-gray-600 text-sm md:text-base">Selecciona una mesa para gestionar pedidos</p>
  </div>

  <!-- Filtros por SalÃ³n -->
  <div class="flex flex-wrap gap-2 mb-6">
    <button
      *ngFor="let salon of salones"
      (click)="filtrarPorSalon(salon.id)"
      [class.bg-gradient-to-r]="salonSeleccionado === salon.id"
      [class.from-orange-500]="salonSeleccionado === salon.id"
      [class.to-orange-600]="salonSeleccionado === salon.id"
      [class.text-white]="salonSeleccionado === salon.id"
      [class.shadow-lg]="salonSeleccionado === salon.id"
      [class.bg-white]="salonSeleccionado !== salon.id"
      [class.text-gray-700]="salonSeleccionado !== salon.id"
      [class.border]="salonSeleccionado !== salon.id"
      [class.border-gray-300]="salonSeleccionado !== salon.id"
      class="px-4 md:px-6 py-2 md:py-3 rounded-xl font-semibold text-sm md:text-base hover:scale-105 transform transition-all duration-200"
    >
      {{ salon.nombre }}
    </button>
  </div>

  <!-- Leyenda de estados -->
  <div class="flex flex-wrap items-center gap-4 md:gap-6 mb-6 p-4 bg-white rounded-xl shadow-sm border border-gray-200">
    <div class="flex items-center space-x-2">
      <div class="w-3 h-3 rounded-full" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);"></div>
      <span class="text-xs md:text-sm font-medium text-gray-700">Libre</span>
    </div>
    <div class="flex items-center space-x-2">
      <div class="w-3 h-3 rounded-full" style="background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);"></div>
      <span class="text-xs md:text-sm font-medium text-gray-700">Ocupada</span>
    </div>
    <div class="flex items-center space-x-2">
      <div class="w-3 h-3 rounded-full" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);"></div>
      <span class="text-xs md:text-sm font-medium text-gray-700">Pide Cuenta</span>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="flex justify-center items-center h-64">
    <div class="animate-spin rounded-full h-12 w-12 border-4 border-orange-200 border-t-orange-600"></div>
  </div>

  <!-- Grid de Mesas con colores personalizados -->
  <div *ngIf="!isLoading" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-3 md:gap-4">
    <div
      *ngFor="let mesa of mesasFiltradas"
      (click)="abrirModal(mesa)"
      class="relative group cursor-pointer transform transition-all duration-300 hover:scale-105 hover:z-10"
    >
      <!-- Card de mesa con colores personalizados -->
      <div
        [style.background]="
          mesa.estado_id === 0 ? 'linear-gradient(135deg, #10b981 0%, #059669 100%)' :
          mesa.estado_id === 1 ? 'linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%)' :
          'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)'
        "
        class="rounded-2xl shadow-lg p-4 md:p-6 text-white flex flex-col items-center justify-center aspect-square relative overflow-hidden"
      >
        <!-- Efecto de brillo -->
        <div class="absolute inset-0 bg-gradient-to-tr from-white/0 via-white/10 to-white/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>

        <!-- Icono de mesa de RESTAURANTE (Lucide) -->
        <div class="relative z-10">
          <!-- Icono UtensilsCrossed (cubiertos cruzados) -->
          <svg class="w-8 h-8 md:w-10 md:h-10 mb-2 opacity-90" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
            <path d="m16 2-2.3 2.3a3 3 0 0 0 0 4.2l1.8 1.8a3 3 0 0 0 4.2 0L22 8"></path>
            <path d="M15 15 3.3 3.3a4.2 4.2 0 0 0 0 6l7.3 7.3c.7.7 2 .7 2.8 0L15 15Zm0 0 7 7"></path>
            <path d="m2.1 21.8 6.4-6.3"></path>
            <path d="m19 5-7 7"></path>
          </svg>

          <!-- NÃºmero de mesa -->
          <p class="text-xl md:text-2xl font-bold mb-1">{{ mesa.numero }}</p>

          <!-- Comensales -->
          <div *ngIf="mesa.estado_id !== 0" class="flex items-center justify-center space-x-1 text-xs opacity-90">
            <svg class="w-3 h-3" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
            </svg>
            <span class="font-semibold">{{ mesa.comensales }}/{{ mesa.capacidad }}</span>
          </div>
        </div>

        <!-- Badge de estado -->
        <div
          *ngIf="mesa.estado_id !== 0"
          class="absolute top-2 right-2 w-2 h-2 rounded-full bg-white shadow-lg animate-pulse"
        ></div>
      </div>
    </div>
  </div>

  <!-- Modal REGISTRAR COMENSALES -->
  <div
    *ngIf="showModal"
    class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fadeIn"
    (click)="cerrarModal()"
  >
    <div
      class="bg-white rounded-3xl shadow-2xl max-w-md w-full p-6 md:p-8 transform transition-all scale-100 animate-slideUp"
      (click)="$event.stopPropagation()"
    >
      <!-- Header del modal con icono correcto -->
      <div class="text-center mb-8">
        <div class="inline-flex items-center justify-center w-20 h-20 rounded-2xl bg-gradient-to-br from-gray-100 to-gray-200 mb-4 shadow-inner">
          <!-- Icono UtensilsCrossed -->
          <svg class="w-10 h-10 text-gray-600" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
            <path d="m16 2-2.3 2.3a3 3 0 0 0 0 4.2l1.8 1.8a3 3 0 0 0 4.2 0L22 8"></path>
            <path d="M15 15 3.3 3.3a4.2 4.2 0 0 0 0 6l7.3 7.3c.7.7 2 .7 2.8 0L15 15Zm0 0 7 7"></path>
            <path d="m2.1 21.8 6.4-6.3"></path>
            <path d="m19 5-7 7"></path>
          </svg>
        </div>
        <h2 class="text-3xl md:text-4xl font-bold text-gray-900">MESA {{ mesaSeleccionada?.numero }}</h2>
        <p class="text-sm text-gray-500 mt-1">Capacidad: {{ mesaSeleccionada?.capacidad }} personas</p>
      </div>

      <!-- Comensales -->
      <div class="mb-8">
        <div class="flex flex-col items-center space-y-4">
          <button
            (click)="incrementarComensales()"
            class="w-14 h-14 rounded-2xl bg-gradient-to-br from-gray-100 to-gray-200 hover:from-gray-200 hover:to-gray-300 flex items-center justify-center shadow-md hover:shadow-lg transition-all transform hover:scale-105 active:scale-95"
          >
            <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M5 15l7-7 7 7"></path>
            </svg>
          </button>

          <div class="text-center">
            <p class="text-sm text-gray-500 mb-2 font-medium">Comensales</p>
            <div class="relative">
              <div class="text-7xl md:text-8xl font-bold bg-gradient-to-br from-gray-900 to-gray-600 bg-clip-text text-transparent">
                {{ comensalesTemp }}
              </div>
              <div class="absolute -bottom-2 left-1/2 transform -translate-x-1/2 flex items-center space-x-1">
                <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                </svg>
                <span class="text-xs text-gray-400">mÃ¡x. {{ mesaSeleccionada?.capacidad }}</span>
              </div>
            </div>
          </div>

          <button
            (click)="decrementarComensales()"
            class="w-14 h-14 rounded-2xl bg-gradient-to-br from-gray-100 to-gray-200 hover:from-gray-200 hover:to-gray-300 flex items-center justify-center shadow-md hover:shadow-lg transition-all transform hover:scale-105 active:scale-95"
          >
            <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" stroke-width="3" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>
        </div>
      </div>

      <!-- BotÃ³n Registrar -->
      <button
        (click)="registrarMesa()"
        class="w-full py-4 text-white rounded-2xl font-bold text-lg shadow-lg hover:shadow-xl transition-all transform hover:scale-105 active:scale-95 mb-3"
        style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);"
      >
        <span class="flex items-center justify-center space-x-2">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path>
          </svg>
          <span>REGISTRAR</span>
        </span>
      </button>

      <!-- Botones secundarios -->
      <div class="grid grid-cols-2 gap-3 mb-3">
        <button
          (click)="cambiarEstado(2)"
          class="py-3 text-white rounded-xl font-semibold text-sm shadow-md hover:shadow-lg transition-all transform hover:scale-105 active:scale-95"
          style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);"
        >
          Pide Cuenta
        </button>
        <button
          (click)="cambiarEstado(0)"
          class="py-3 text-white rounded-xl font-semibold text-sm shadow-md hover:shadow-lg transition-all transform hover:scale-105 active:scale-95"
          style="background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);"
        >
          Liberar Mesa
        </button>
      </div>

      <!-- BotÃ³n cerrar -->
      <button
        (click)="cerrarModal()"
        class="w-full py-3 border-2 border-gray-200 text-gray-600 rounded-xl font-semibold hover:bg-gray-50 hover:border-gray-300 transition-all"
      >
        Cancelar
      </button>
    </div>
  </div>

  <!-- MODAL COBRO (Solo para caja) -->
  <div
    *ngIf="showModalCobro"
    class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4"
    (click)="cerrarModalCobro()"
  >
    <div
      class="bg-white rounded-3xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6 md:p-8 transform transition-all"
      (click)="$event.stopPropagation()"
    >
      <!-- Header -->
      <div class="flex items-center justify-between mb-6">
        <div>
          <h2 class="text-3xl font-bold text-gray-900">Mesa {{ mesaSeleccionada?.numero }}</h2>
          <p class="text-gray-600 text-sm">{{ mesaSeleccionada?.comensales }} comensales</p>
        </div>
        <button (click)="cerrarModalCobro()" class="text-gray-400 hover:text-gray-600">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <!-- Resumen por envÃ­os -->
      <div class="space-y-4 mb-6">
        <div *ngFor="let envioNum of getEnviosUnicos()" class="bg-gray-50 rounded-xl p-4">
          <h3 class="text-sm font-semibold text-gray-700 mb-3 uppercase">EnvÃ­o #{{ envioNum }}</h3>

          <div class="space-y-2">
            <div *ngFor="let item of getItemsPorEnvio(envioNum)" class="flex items-center justify-between py-2 border-b border-gray-200 last:border-0">
              <div class="flex-1">
                <p class="text-sm font-semibold text-gray-900">{{ item.producto_nombre }}</p>
                <div class="flex items-center space-x-3 text-xs text-gray-600 mt-1">
                  <span>Cantidad: {{ item.cantidad }}</span>
                  <span>Ã—</span>
                  <span>S/ {{ item.precio }}</span>
                </div>
                <p *ngIf="item.observaciones" class="text-xs text-gray-500 italic mt-1">{{ item.observaciones }}</p>
              </div>
              <p class="text-sm font-bold text-gray-900 ml-4">S/ {{ item.subtotal }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Total -->
      <div class="bg-gradient-to-r from-orange-50 to-orange-100 rounded-2xl p-6 mb-6">
        <div class="flex items-center justify-between">
          <span class="text-lg font-semibold text-gray-700">Total a Cobrar</span>
          <span class="text-4xl font-bold text-orange-600">S/ {{ ordenCobro?.total || 0 }}</span>
        </div>
      </div>

      <!-- MÃ©todo de pago -->
      <div class="mb-6">
        <label class="block text-sm font-semibold text-gray-700 mb-3">MÃ©todo de Pago</label>
        <div class="grid grid-cols-3 gap-3">
          <button
            (click)="metodoPago = 'efectivo'"
            [class.bg-orange-500]="metodoPago === 'efectivo'"
            [class.text-white]="metodoPago === 'efectivo'"
            [class.bg-gray-100]="metodoPago !== 'efectivo'"
            [class.text-gray-700]="metodoPago !== 'efectivo'"
            class="py-3 px-4 rounded-xl font-semibold transition-all hover:scale-105"
          >
            ðŸ’µ Efectivo
          </button>
          <button
            (click)="metodoPago = 'tarjeta'"
            [class.bg-orange-500]="metodoPago === 'tarjeta'"
            [class.text-white]="metodoPago === 'tarjeta'"
            [class.bg-gray-100]="metodoPago !== 'tarjeta'"
            [class.text-gray-700]="metodoPago !== 'tarjeta'"
            class="py-3 px-4 rounded-xl font-semibold transition-all hover:scale-105"
          >
            ðŸ’³ Tarjeta
          </button>
          <button
            (click)="metodoPago = 'yape'"
            [class.bg-orange-500]="metodoPago === 'yape'"
            [class.text-white]="metodoPago === 'yape'"
            [class.bg-gray-100]="metodoPago !== 'yape'"
            [class.text-gray-700]="metodoPago !== 'yape'"
            class="py-3 px-4 rounded-xl font-semibold transition-all hover:scale-105"
          >
            ðŸ“± Yape/Plin
          </button>
        </div>
      </div>

      <!-- Botones -->
      <div class="flex space-x-3">
        <button
          (click)="cerrarModalCobro()"
          class="flex-1 py-3 border-2 border-gray-300 text-gray-700 rounded-xl font-semibold hover:bg-gray-50 transition-all"
        >
          Cancelar
        </button>
        <button
          (click)="cobrar()"
          class="flex-1 py-3 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all transform hover:scale-[1.02]"
        >
          <span class="flex items-center justify-center space-x-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <span>Proceder al Pago</span>
          </span>
        </button>
      </div>
    </div>
  </div>
</div>
