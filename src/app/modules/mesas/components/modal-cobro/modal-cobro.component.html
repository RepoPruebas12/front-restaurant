<div class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4"
     (click)="onCerrar()">
  <div class="bg-white rounded-3xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6 md:p-8 transform transition-all"
       (click)="$event.stopPropagation()">

    <!-- Header -->
    <div class="flex items-center justify-between mb-6">
      <div>
        <h2 class="text-3xl font-bold text-gray-900">Mesa {{ mesa?.numero }}</h2>
        <p class="text-gray-600 text-sm">{{ mesa?.comensales }} comensales</p>
      </div>
      <button (click)="onCerrar()" class="text-gray-400 hover:text-gray-600">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <!-- Resumen por envÃ­os -->
    <div class="space-y-4 mb-6">
      <div *ngFor="let envioNum of getEnviosUnicos()" class="bg-gray-50 rounded-xl p-4">
        <h3 class="text-sm font-semibold text-gray-700 mb-3 uppercase">EnvÃ­o #{{ envioNum }}</h3>

        <div class="space-y-2">
          <div *ngFor="let item of getItemsPorEnvio(envioNum)"
               class="flex items-center justify-between py-2 border-b border-gray-200 last:border-0">
            <div class="flex-1">
              <p class="text-sm font-semibold text-gray-900">{{ item.producto_nombre }}</p>
              <div class="flex items-center space-x-3 text-xs text-gray-600 mt-1">
                <span>Cantidad: {{ item.cantidad }}</span>
                <span>Ã—</span>
                <span>S/ {{ item.precio }}</span>
              </div>
              <p *ngIf="item.observaciones" class="text-xs text-gray-500 italic mt-1">{{ item.observaciones }}</p>
            </div>
            <p class="text-sm font-bold text-gray-900 ml-4">S/ {{ item.subtotal }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Total -->
    <div class="bg-gradient-to-r from-orange-50 to-orange-100 rounded-2xl p-6 mb-6">
      <div class="flex items-center justify-between">
        <span class="text-lg font-semibold text-gray-700">Total a Cobrar</span>
        <span class="text-4xl font-bold text-orange-600">S/ {{ orden?.total || 0 }}</span>
      </div>
    </div>

    <!-- MÃ©todo de pago -->
    <div class="mb-6">
      <label class="block text-sm font-semibold text-gray-700 mb-3">MÃ©todo de Pago</label>
      <div class="grid grid-cols-3 gap-3">
        <button (click)="onCambiarMetodo('efectivo')"
                [class.bg-orange-500]="metodoPago === 'efectivo'"
                [class.text-white]="metodoPago === 'efectivo'"
                [class.bg-gray-100]="metodoPago !== 'efectivo'"
                [class.text-gray-700]="metodoPago !== 'efectivo'"
                class="py-3 px-4 rounded-xl font-semibold transition-all hover:scale-105">
          ðŸ’µ Efectivo
        </button>
        <button (click)="onCambiarMetodo('tarjeta')"
                [class.bg-orange-500]="metodoPago === 'tarjeta'"
                [class.text-white]="metodoPago === 'tarjeta'"
                [class.bg-gray-100]="metodoPago !== 'tarjeta'"
                [class.text-gray-700]="metodoPago !== 'tarjeta'"
                class="py-3 px-4 rounded-xl font-semibold transition-all hover:scale-105">
          ðŸ’³ Tarjeta
        </button>
        <button (click)="onCambiarMetodo('yape')"
                [class.bg-orange-500]="metodoPago === 'yape'"
                [class.text-white]="metodoPago === 'yape'"
                [class.bg-gray-100]="metodoPago !== 'yape'"
                [class.text-gray-700]="metodoPago !== 'yape'"
                class="py-3 px-4 rounded-xl font-semibold transition-all hover:scale-105">
          ðŸ“± Yape/Plin
        </button>
      </div>
    </div>

    <!-- Botones -->
    <div class="flex space-x-3">
      <button (click)="onCerrar()"
              class="flex-1 py-3 border-2 border-gray-300 text-gray-700 rounded-xl font-semibold hover:bg-gray-50 transition-all">
        Cancelar
      </button>
      <button (click)="onCobrar()"
              class="flex-1 py-3 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all transform hover:scale-[1.02]">
        <span class="flex items-center justify-center space-x-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <span>Proceder al Pago</span>
        </span>
      </button>
    </div>
  </div>
</div>
