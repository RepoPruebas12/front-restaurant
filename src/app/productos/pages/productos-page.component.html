<div class="container mx-auto p-6">
  <!-- Header con Buscador -->
  <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
    <h1 class="text-3xl font-bold text-gray-800">Productos</h1>

    <div class="flex flex-col md:flex-row gap-3 w-full md:w-auto">
      <!-- Buscador -->
      <div class="relative flex-1 md:w-80">
        <lucide-icon
          [img]="Search"
          [size]="20"
          class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">
        </lucide-icon>
        <input
          type="text"
          [(ngModel)]="searchTerm"
          (input)="buscarProducto()"
          placeholder="Buscar productos..."
          class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
      </div>

      <!-- Botón Nuevo -->
      <button
        (click)="abrirModal()"
        class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center justify-center gap-2 whitespace-nowrap">
        <lucide-icon [img]="Plus" [size]="20"></lucide-icon>
        <span>Nuevo Producto</span>
      </button>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6" *ngIf="stats">
    <div class="bg-white p-4 rounded-lg shadow hover:shadow-md transition">
      <p class="text-gray-500 text-sm">Total Productos</p>
      <p class="text-2xl font-bold text-gray-800">{{ stats.productos_activos }}</p>
    </div>
    <div class="bg-white p-4 rounded-lg shadow hover:shadow-md transition">
      <p class="text-gray-500 text-sm">Bajo Stock</p>
      <p class="text-2xl font-bold text-orange-600">{{ stats.bajo_stock }}</p>
    </div>
    <div class="bg-white p-4 rounded-lg shadow hover:shadow-md transition">
      <p class="text-gray-500 text-sm">Sin Stock</p>
      <p class="text-2xl font-bold text-red-600">{{ stats.sin_stock }}</p>
    </div>
    <div class="bg-white p-4 rounded-lg shadow hover:shadow-md transition">
      <p class="text-gray-500 text-sm">Valor Inventario</p>
      <p class="text-2xl font-bold text-green-600">S/ {{ stats.valor_inventario | number:'1.2-2' }}</p>
    </div>
  </div>

  <!-- Tabla de Productos -->
  <div class="bg-white rounded-lg shadow overflow-hidden">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nombre</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Categoría</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Precio</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stock</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        <tr *ngFor="let producto of productosFiltrados" class="hover:bg-gray-50 transition">
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm font-medium text-gray-900">{{ producto.nombre }}</div>
            <div class="text-sm text-gray-500">{{ producto.descripcion }}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
              {{ producto.categoria_nombre || 'Sin categoría' }}
            </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-semibold">
            S/ {{ producto.precio_venta | number:'1.2-2' }}
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span
              [class]="producto.stock_actual <= producto.stock_minimo ? 'text-red-600' : 'text-green-600'"
              class="text-sm font-semibold">
              {{ producto.stock_actual }}
            </span>
            <span class="text-xs text-gray-500"> / {{ producto.stock_minimo }}</span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
            <button
              (click)="abrirModal(producto)"
              class="inline-flex items-center gap-1 text-blue-600 hover:text-blue-900 mr-3 transition">
              <lucide-icon [img]="Edit" [size]="16"></lucide-icon>
              <span>Editar</span>
            </button>
            <button
              (click)="eliminarProducto(producto.id!)"
              class="inline-flex items-center gap-1 text-red-600 hover:text-red-900 transition">
              <lucide-icon [img]="Trash2" [size]="16"></lucide-icon>
              <span>Eliminar</span>
            </button>
          </td>
        </tr>
        <tr *ngIf="productosFiltrados.length === 0">
          <td colspan="5" class="px-6 py-8 text-center text-gray-500">
            <div class="flex flex-col items-center gap-2">
              <lucide-icon [img]="Search" [size]="48" class="text-gray-300"></lucide-icon>
              <p class="text-lg font-medium">No se encontraron productos</p>
              <p class="text-sm">Intenta con otros términos de búsqueda</p>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Modal -->
  <div *ngIf="showModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
      <div class="p-6">
        <h2 class="text-2xl font-bold mb-4">
          {{ productoForm.id ? 'Editar Producto' : 'Nuevo Producto' }}
        </h2>

        <form (ngSubmit)="guardarProducto()">
          <div class="grid grid-cols-2 gap-4">
            <!-- Nombre -->
            <div class="col-span-2">
              <label class="block text-sm font-medium text-gray-700 mb-2">Nombre *</label>
              <input
                type="text"
                [(ngModel)]="productoForm.nombre"
                name="nombre"
                required
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>

            <!-- Categoría -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Categoría</label>
              <select
                [(ngModel)]="productoForm.categoria_id"
                name="categoria_id"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option [ngValue]="null">Sin categoría</option>
                <option *ngFor="let cat of categorias" [ngValue]="cat.id">{{ cat.nombre }}</option>
              </select>
            </div>

            <!-- Precio -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Precio Venta *</label>
              <input
                type="number"
                [(ngModel)]="productoForm.precio_venta"
                name="precio_venta"
                step="0.01"
                required
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>

            <!-- Stock Actual -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Stock Actual</label>
              <input
                type="number"
                [(ngModel)]="productoForm.stock_actual"
                name="stock_actual"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>

            <!-- Stock Mínimo -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Stock Mínimo</label>
              <input
                type="number"
                [(ngModel)]="productoForm.stock_minimo"
                name="stock_minimo"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>

            <!-- Descripción -->
            <div class="col-span-2">
              <label class="block text-sm font-medium text-gray-700 mb-2">Descripción</label>
              <textarea
                [(ngModel)]="productoForm.descripcion"
                name="descripcion"
                rows="3"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
            </div>

            <!-- Foto URL -->
            <div class="col-span-2">
              <label class="block text-sm font-medium text-gray-700 mb-2">URL de Foto</label>
              <input
                type="text"
                [(ngModel)]="productoForm.foto"
                name="foto"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
          </div>

          <!-- Botones -->
          <div class="flex justify-end gap-3 mt-6">
            <button
              type="button"
              (click)="cerrarModal()"
              class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition">
              Cancelar
            </button>
            <button
              type="submit"
              class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
              Guardar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
